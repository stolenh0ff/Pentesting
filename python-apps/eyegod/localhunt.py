# |jackcooper|
# Educational Purposes Only

import os
import time
import requests
import socket

from rich.console import Console
from rich.table import Table
from scapy.all import ARP, Ether, srp

def localhunt():
    target_network = "192.168.1.0/24"
    arp = ARP(pdst=target_network)
    ether = Ether(dst="ff:ff:ff:ff:ff:ff")
    packet = ether/arp
    result = srp(packet, timeout=1, verbose=0)[0]
    macapi_url = "https://api.macvendors.com/"
    table = Table(title="")
    rows = []
    columns = []
    table.add_column("IP Address", justify="right", style="cyan", no_wrap=True)
    table.add_column("Hostname", style="magenta")
    table.add_column("Mac Address", justify="right", style="green")
    table.add_column("Vendor", style="magenta")
    for sent, received in result:
        hostname = socket.getfqdn(received.psrc)
        mac_vendor = requests.get(macapi_url+received.hwsrc).content.decode()
        if mac_vendor == '{"errors":{"detail":"Not Found"}}':
            mac_vendor = "Unknown Vendor"
        if hostname == received.psrc:
            hostname = ""
        rows.append([received.psrc, hostname, received.hwsrc, mac_vendor])
        time.sleep(0.5)
    for column in columns:
        table.add_column(column)
    for row in rows:
        table.add_row(*row, style='cyan')
    #print table
    console = Console()
    console.print(table)

os.system("clear")
localhunt()