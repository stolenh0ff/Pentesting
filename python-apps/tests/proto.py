# |jackcooper|
# Educational Purposes Only

import os
import time
import requests
import socket
import webview

from pyvis.network import Network
from rich.console import Console
from rich.table import Table
from scapy.all import ARP, Ether, srp

def localhunt():

    target_network = "192.168.1.0/24"
    arp = ARP(pdst=target_network)
    ether = Ether(dst="ff:ff:ff:ff:ff:ff")
    packet = ether/arp
    result = srp(packet, timeout=1, verbose=0)[0]

    g = Network(height="750px", width="100%", bgcolor="#222222", font_color="white")

    macapi_url = "https://api.macvendors.com/"

    table = Table(title="")
    rows = []
    columns = []

    nodestart = 0

    table.add_column("IP Address", justify="right", style="cyan", no_wrap=True)
    table.add_column("Hostname", style="magenta")
    table.add_column("Mac Address", justify="right", style="green")
    table.add_column("Vendor", style="magenta")

    for sent, received in result:
        hostname = "Temporal Hostname" #socket.gethostbyaddr(received.psrc) 
        mac_vendor = requests.get(macapi_url+received.hwsrc).content.decode()
        if mac_vendor == '{"errors":{"detail":"Not Found"}}':
            mac_vendor = "Unknown Vendor"
        rows.append([received.psrc, hostname, received.hwsrc, mac_vendor])
        time.sleep(0.5)
        g.add_node(nodestart+1, value=100, color='#162347', label=f"IP Address: {received.psrc}\nMac: {received.hwsrc}")

    for column in columns:
        table.add_column(column)
    for row in rows:
        table.add_row(*row, style='cyan')

#print table
    console = Console()
    console.print(table)

os.system("clear")
localhunt()

#html page located in the same folder as the script
g.toggle_physics(True)
g.show("basic.html")

#spawn webview
webview.create_window('Network', 'basic.html')
webview.start()