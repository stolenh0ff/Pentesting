# /CVE_Finder/ "A Python Based Tool for CVE Information Gathering"
# v0.1
# |jackcooper|

import requests
import os
from rich.console import Console
from rich.table import Table

keyword_cve = input("Enter the keyword you are looking for: ")
os.system("clear")

api_url = f"https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch={keyword_cve}"

response = requests.get(api_url)
if response.status_code == 200:
    data = response.json()
    totalResults = data["totalResults"]
    cve_ids = data["vulnerabilities"][0]["cve"]["id"]
    desc_text = data["vulnerabilities"][0]["cve"]["descriptions"][0]["value"]
    vuln_status = data["vulnerabilities"][0]["cve"]["vulnStatus"]
    source = data["vulnerabilities"][0]["cve"]["references"][0]["source"]
    table = Table(title="")
    columns = ["CVE-ID", "Description", "Status", "Confidentiality", "Integrity", "Availability", "Score", "Source"]
    rows = [
    ]

    #confidentiality checker
    if "cvssMetricV31" in data["vulnerabilities"][0]["cve"]["metrics"]:
        conf_imp = data["vulnerabilities"][0]["cve"]["metrics"]["cvssMetricV31"][0]["cvssData"]["confidentialityImpact"]
    elif "cvssMetricV2" in data["vulnerabilities"][0]["cve"]["metrics"]:
        conf_imp = data["vulnerabilities"][0]["cve"]["metrics"]["cvssMetricV2"][0]["cvssData"]["confidentialityImpact"]
    else:
        conf_imp = "N/A"
    #integrity checker
    if "cvssMetricV31" in data["vulnerabilities"][0]["cve"]["metrics"]:
        int_imp = data["vulnerabilities"][0]["cve"]["metrics"]["cvssMetricV31"][0]["cvssData"]["integrityImpact"]
    elif "cvssMetricV2" in data["vulnerabilities"][0]["cve"]["metrics"]:
        int_imp = data["vulnerabilities"][0]["cve"]["metrics"]["cvssMetricV2"][0]["cvssData"]["integrityImpact"]
    else:
        int_imp = "N/A"    
    #availability checker
    if "cvssMetricV31" in data["vulnerabilities"][0]["cve"]["metrics"]:
        ava_imp = data["vulnerabilities"][0]["cve"]["metrics"]["cvssMetricV31"][0]["cvssData"]["availabilityImpact"]
    elif "cvssMetricV2" in data["vulnerabilities"][0]["cve"]["metrics"]:
        ava_imp = data["vulnerabilities"][0]["cve"]["metrics"]["cvssMetricV2"][0]["cvssData"]["availabilityImpact"]
    else:
        ava_imp = "N/A"    
    #base score
    if "cvssMetricV31" in data["vulnerabilities"][0]["cve"]["metrics"]:
        base_score = str(data["vulnerabilities"][0]["cve"]["metrics"]["cvssMetricV31"][0]["cvssData"]["baseScore"])
    elif "cvssMetricV2" in data["vulnerabilities"][0]["cve"]["metrics"]:
        base_score = str(data["vulnerabilities"][0]["cve"]["metrics"]["cvssMetricV2"][0]["cvssData"]["baseScore"])
    else:
        ava_imp = "N/A"  

    for i in range(1):
        rows.append([cve_ids, desc_text, vuln_status, conf_imp, int_imp, ava_imp, base_score, source])
    for column in columns:
        table.add_column(column)
    for row in rows:
        table.add_row(*row, style='bright_green')

    print(f"Total Results: {totalResults}")
    console = Console()
    console.print(table)

else:
    print("An error occurred while retrieving data from the API.")